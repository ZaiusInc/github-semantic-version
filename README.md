# github-semantic-version

> Automated semantic version releases powered by Github Issues.

[![travis build](https://img.shields.io/travis/ericclemmons/github-semantic-version.svg)](https://travis-ci.org/ericclemmons/github-semantic-version)
[![version](https://img.shields.io/npm/v/github-semantic-version.svg)](http://npm.im/github-semantic-version)
[![downloads](https://img.shields.io/npm/dm/github-semantic-version.svg)](http://npm-stat.com/charts.html?package=github-semantic-version)
[![MIT License](https://img.shields.io/npm/l/github-semantic-version.svg)](http://opensource.org/licenses/MIT)

- - -

## Getting Started

### 1. Install

```shell
$ npm install --save-dev github-semantic-version
```

### 2. Add `GH_TOKEN` & `NPM_TOKEN` to CI

For example, in Travis CI's "Settings" tab for your project, you'll see:
> ![tokens](tokens.png)

For your `GH_TOKEN` [create one in Github](https://github.com/settings/tokens)
with `repo` credentials.

You can find `NPM_TOKEN` in your `~/.npmrc` file:

```
//registry.npmjs.org/:_authToken=${NPM_TOKEN}
```


### 3. Create labels

```shell
$ npm install --save-dev git-labelmaker
```

```shell
$ git-labelmaker
? What is your GitHub Access Token? <paste token here>
? What is your master password, to keep your access token secure? ************
? Welcome to git-labelmaker!
What would you like to do?
> Add Labels From Package
? What is the path & name of the package you want to use? (eg: `packages/my-label-pkg.json`) ./node_modules/github-semantic-version/labels.json
Successfully created 3 labels
```

### 4. Add labels to issues

Add one of the following labels to your open PRs:

- `Version: Major`
- `Version: Minor`
- `Version: Patch`

As these get merged, `github-semantic-version` will use this to determine
how to bump the current version. _PRs merged without a label will be treated
as `patch` releases._

_If any un-tagged commits are pushed to `master` outside of a PR, they're
automatically treated as `patch` releases._

Once these are in place, your new versions can be pushed back to Github & NPM
without permissions & security issues.

### 5. Update `.travis.yml`

```yaml
sudo: false
language: node_js
cache:
  directories:
    - node_modules
notifications:
  email: false
branches:
  except:
    - /^v[0-9]/
deploy:
  provider: script
  script: npm run release
  skip_cleanup: true
  on:
    branch: master
```

### 6. Usage

#### Basic Usage in a CI Environment (No CHANGELOG)

`github-semantic-version`

Update the package version, push to Github, publish to NPM.

#### Generate a Fresh CHANGELOG and Calculate Package Version (Non CI environment)

`github-semantic-version -h`

Generates a fresh CHANGELOG based on labeled PRs and any commits to `master` outside
of any PR. Also calculates the package version based on those PRs and commits. Will automatically
push and publish unless the `-r` or `--dry-run` option is used.

This is best used as a one off to generate the initial CHANGELOG.

#### Update the CHANGELOG on Every Merge or Commit to `master` (CI Environment)

`github-semantic-version -c`

This will function similar to the basic usage, but will also append the latest change to an
existing CHANGELOG (must have already been generated by the command above).

You'll want to run `github-semantic-version -h` outside of CI to generate the initial CHANGELOG
before enabling the `-c` flag.

### 7. Update `package.json`

```json
{
  "scripts": {
    ...
    "prerelease": "npm run build",
    "release": "github-semantic-version",
    ...
  }
}
```

You can add a `startVersion` to `package.json` that will be used as the starting point to
calculate the package version of a repo. Ex:

```json
{
  ...
  "startVersion": "2.5.0",
  ...
}
```

If you're working on an private project, you can leave out `npm publish`, which
means you have no need for your `NPM_TOKEN` either.


### License

> MIT License 2016 Â© Eric Clemmons
